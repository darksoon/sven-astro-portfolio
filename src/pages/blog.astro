---
// src/pages/blog.astro
// Blog-√úbersicht - listet alle Markdown-Posts auf

import { getCollection } from 'astro:content';
import { siteConfig, getPageTitle, getMetaDescription } from '@/config/site';
import PortfolioLayout from '../layouts/PortfolioLayout.astro';

// Alle Blog-Posts laden, Drafts filtern und nach Datum sortieren
const posts = await getCollection('blog', ({ data }) => {
    return data.draft !== true;
});
posts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const pageTitle = getPageTitle(siteConfig.blog.title.de, 'de');
const pageDescription = siteConfig.blog.description.de;
---

<PortfolioLayout title={pageTitle} description={pageDescription}>
    <section class="blog-listing">
        <div class="container">
            <div class="section-header">
                <span class="section-tag">Blog</span>
                <h1 class="section-title" data-de="üìù Blog" data-en="üìù Blog">üìù Blog</h1>
                <p class="section-subtitle" data-de="Projekte, Homelab-Setups und Lessons Learned" data-en="Projects, homelab setups and lessons learned">Projekte, Homelab-Setups und Lessons Learned</p>
            </div>

            {posts.length === 0 && (
                <div class="empty-state">
                    <p>Noch keine Posts ‚Äì aber bald! üöÄ</p>
                </div>
            )}

            <div class="posts-grid">
                {posts.map((post) => (
                    <a href={`/blog/${post.slug}`} class="post-card">
                        <div class="post-card-meta">
                            <time datetime={post.data.date.toISOString()}>
                                {post.data.date.toLocaleDateString('de-DE', {
                                    year: 'numeric',
                                    month: 'long',
                                    day: 'numeric'
                                })}
                            </time>
                        </div>
                        <h2 class="post-card-title">{post.data.title}</h2>
                        <p class="post-card-desc">{post.data.description}</p>
                        <div class="post-card-tags">
                            {post.data.tags.map((tag: string) => (
                                <span class="post-card-tag">{tag}</span>
                            ))}
                        </div>
                    </a>
                ))}
            </div>
        </div>
    </section>
</PortfolioLayout>

<style>
    .blog-listing {
        padding-top: 8rem;
    }

    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: #6b6b7b;
        font-size: 1.2rem;
    }

    .posts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
        gap: 2rem;
    }

    .post-card {
        display: block;
        background: rgba(26, 26, 37, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 16px;
        padding: 2rem;
        text-decoration: none;
        transition: all 0.3s ease;
    }

    .post-card:hover {
        background: rgba(26, 26, 37, 0.6);
        border-color: #00d9ff;
        transform: translateY(-4px);
        box-shadow: 0 0 40px rgba(0, 217, 255, 0.1), 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .post-card-meta time {
        color: #00d9ff;
        font-size: 0.8rem;
        font-family: 'JetBrains Mono', monospace;
    }

    .post-card-title {
        font-size: 1.4rem;
        font-weight: 700;
        color: #fff;
        margin: 0.75rem 0;
        line-height: 1.3;
    }

    .post-card-desc {
        color: #a0a0a0;
        font-size: 0.95rem;
        margin-bottom: 1.25rem;
        line-height: 1.6;
    }

    .post-card-tags {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }

    .post-card-tag {
        padding: 0.2rem 0.6rem;
        background: rgba(0, 217, 255, 0.1);
        border: 1px solid rgba(0, 217, 255, 0.2);
        border-radius: 20px;
        font-size: 0.7rem;
        color: #00d9ff;
    }

    @media (max-width: 768px) {
        .posts-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
